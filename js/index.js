"use strict";const appPuzzle=()=>{const e=document.getElementById("app__puzzle"),n=document.getElementById("app__puzzle--lock"),o=document.getElementById("app__shuffle"),t=document.getElementById("app__counter"),M=document.getElementById("app__result--count"),T=document.getElementById("app__result--time"),$=document.getElementById("app__record--count"),P=document.getElementById("app__record--time"),a=Array.from(e.querySelectorAll(".app__puzzle--btn")),r=document.querySelector(".app__rules"),l=document.querySelector(".app__box"),c=document.querySelector(".app__puzzle--public"),s=document.querySelector(".app__record"),i=document.querySelector(".app__record--time"),u=document.querySelector(".preloader"),d=document.getElementById("minute"),m=document.getElementById("second"),p=document.getElementById("millisecond"),y=new Array(16).fill(0).map((t,e)=>e+1),g={count:0,time:"00:00:00",ms:0},x=16,D=4,H=100;let h=!1,_=[],I=null,f=null,v=null,b=0,S=0,C=0,E=null;t.textContent=g.count;const j=()=>{b=0,S=0,C=0,p.textContent=k(C),m.textContent=k(S),d.textContent=k(b)},z=()=>{var t=JSON.parse(localStorage.getItem("data"));$.textContent=t.count,P.textContent=t.time},k=t=>t<10?"0"+t:t,w=(t,e)=>t.classList.add(e),B=(t,e)=>t.classList.remove(e),L=t=>{c.textContent=t,w(c,"open"),setTimeout(()=>B(c,"open"),5e3)},A=()=>{g.count++,t.textContent=g.count},F=()=>{u.classList.contains("hide")||w(u,"hide")},G=()=>{99<C&&(S++,m.textContent=k(S),C=0,p.textContent=k(C)),59<S&&(b++,d.textContent=k(b),S=0,m.textContent=k(S))},K=()=>{C++,p.textContent=k(C),G()},Q=()=>{var t;localStorage.length<1&&(localStorage.setItem("data",JSON.stringify(g)),z()),1<=localStorage.length&&(z(),localStorage.getItem("data")&&(t=JSON.parse(localStorage.getItem("data")),0<g.count&&0===t.count&&(localStorage.setItem("data",JSON.stringify(g)),z(),L("Рекорд установлен!"),w(s,"animate-opacity")),0!==g.count&&g.count<t.count&&(localStorage.setItem("data",JSON.stringify(g)),z(),L("Новый рекорд!"),w(s,"animate-opacity")),g.count>=t.count&&0<t.count&&L("Рекорд не побит!"),g.count===t.count&&g.ms<t.ms&&(localStorage.setItem("data",JSON.stringify(g)),z(),L("Время улучшено!"),w(i,"animate-opacity"))))},R=()=>{var t;(t=>{var e=t.flat();for(let t=0;t<y.length;t++)if(e[t]!==y[t])return!1;return!0})(_)?(g.time=`${k(b)}:${k(S)}:`+k(C),g.ms=10*(t=g.time.split(":"))[2]+1e3*t[1]+6e4*t[0],Q(),o.getAttribute("disabled")&&o.removeAttribute("disabled"),clearInterval(E),M.textContent=g.count,T.textContent=g.time,B(n,"hide"),w(l,"hide"),B(r,"hide"),setTimeout(()=>B(e,"won"),70)):setTimeout(()=>w(e,"won"),70)},U=(t,e,n)=>{t.style.transform=`translate3D(${100*e}%, ${100*n}%, 0)`},N=n=>{for(let e=0;e<n.length;e++)for(let t=0;t<n[e].length;t++){var o=n[e][t],o=a[o-1];U(o,t,e)}R()},q=(n,o)=>{for(let e=0;e<o.length;e++)for(let t=0;t<o[e].length;t++)if(o[e][t]===n)return{y:e,x:t};return null},J=(t,e)=>{var n=Math.abs(t.x-e.x),o=Math.abs(t.y-e.y);return!(1!==n&&1!==o||t.x!==e.x&&t.y!==e.y)},O=(t,e,n)=>{var o=n[t.y][t.x];n[t.y][t.x]=n[e.y][e.x],n[e.y][e.x]=o},V=t=>{var e=q(16,t),n=(({blankCoords:n,matrix:o,blockedCoords:a})=>{const r=[];for(let e=0;e<o.length;e++)for(let t=0;t<o[e].length;t++)!J({x:t,y:e},n)||a&&a.x===t&&a.y===e||r.push({x:t,y:e});return r})({blankCoords:e,matrix:t,blockedCoords:I}),n=n[Math.floor(Math.random()*n.length)];O(e,n,t),I=e};const W=(t,e)=>{t.y>=_.length||t.y<0||t.x>=_.length||t.x<0||(A(),O(t,e,_),N(_))};e.addEventListener("click",({target:t})=>{var e;h||(t=t.closest(".app__puzzle--btn"))&&(t=Number(t.dataset.matrixId),t=q(t,_),e=q(16,_),t=t,e=e,J(t,e)&&(A(),O(t,e,_),N(_)))}),o.addEventListener("click",()=>{h||(h=!0,f=0,g.count=0,t.textContent=g.count,c.classList.contains("open")&&B(c,"open"),s.classList.contains("animate-opacity")&&B(s,"animate-opacity"),i.classList.contains("animate-opacity")&&B(i,"animate-opacity"),clearInterval(v),0===f&&(v=setInterval(()=>{V(_),N(_),o.setAttribute("disabled",!0),(f+=1)>=H&&(w(n,"hide"),w(r,"hide"),B(l,"hide"),j(),clearInterval(v),clearInterval(E),E=setInterval(K,10),h=!1)},20)))}),document.body.addEventListener("keydown",t=>{if(!h&&t.key.includes("Arrow")){var e=q(16,_),n={x:e.x,y:e.y},t=t.key.split("Arrow")[1].toLowerCase(),o=n,n=e;switch(t){case"up":o.y+=1;break;case"down":--o.y;break;case"left":o.x+=1;break;case"right":--o.x}W(o,n)}});if(setTimeout(F,3e3),a.length<x)throw new Error(`Должно быть ровно ${x} items in HTML`);a[x-1].style.display="none";var X=a.map(t=>Number(t.dataset.matrixId));_=(t=>{const e=[[],[],[],[]];let n=0,o=0;for(var a of t)o>=D&&(n++,o=0),e[n][o]=a,o++;return e})(X),N(_)};appPuzzle();