"use strict";const appPuzzle=()=>{const t=document.getElementById("app__puzzle"),o=document.getElementById("app__puzzle--lock"),e=document.getElementById("app__shuffle"),n=document.getElementById("app__counter"),r=document.getElementById("app__result--count"),a=document.getElementById("app__result--time"),l=document.getElementById("app__record--count"),$=document.getElementById("app__record--time"),c=Array.from(t.querySelectorAll(".app__puzzle--btn")),d=document.querySelector(".app__rules"),u=document.querySelector(".app__box"),s=document.querySelector(".preloader"),m=document.getElementById("minute"),i=document.getElementById("second"),y=document.getElementById("millisecond"),p=new Array(16).fill(0).map((t,e)=>e+1),g={count:0,time:"00:00:00"},x=16,h=16,q=4;let I=!1,f=[],_=null,v=null,C=null,S=0,b=0,E=0,k=null;n.textContent=g.count;const z=()=>{var t=JSON.parse(localStorage.getItem("data"));l.textContent=t.count,$.textContent=t.time},w=t=>t<10?"0"+t:t,B=(t,e)=>t.classList.add(e),N=(t,e)=>t.classList.remove(e),L=()=>{g.count++,n.textContent=g.count},T=()=>{s.classList.contains("hide")||B(s,"hide")},P=()=>{99<E&&(b++,i.textContent=w(b),E=0,y.textContent=w(E)),59<b&&(S++,m.textContent=w(S),b=0,i.textContent=w(b))},D=()=>{E++,y.textContent=w(E),P()},H=()=>{(t=>{var e=t.flat();for(let t=0;t<p.length;t++)if(e[t]!==p[t])return!1;return!0})(f)?(g.time=`${w(S)}:${w(b)}:`+w(E),1===localStorage.length&&z(),localStorage.length<1&&(localStorage.setItem("data",JSON.stringify(g)),z()),0<g.count&&0===JSON.parse(localStorage.getItem("data")).count&&(localStorage.setItem("data",JSON.stringify(g)),z()),0!==g.count&&g.count<JSON.parse(localStorage.getItem("data")).count&&(localStorage.setItem("data",JSON.stringify(g)),z()),g.count>JSON.parse(localStorage.getItem("data")).count&&z(),clearInterval(k),r.textContent=g.count,a.textContent=g.time,N(o,"hide"),B(u,"hide"),N(d,"hide"),setTimeout(()=>N(t,"won"),70)):setTimeout(()=>B(t,"won"),70)},j=(t,e,n)=>{t.style.transform=`translate3D(${100*e}%, ${100*n}%, 0)`},J=n=>{for(let e=0;e<n.length;e++)for(let t=0;t<n[e].length;t++){var o=n[e][t],o=c[o-1];j(o,t,e)}H()},O=(n,o)=>{for(let e=0;e<o.length;e++)for(let t=0;t<o[e].length;t++)if(o[e][t]===n)return{y:e,x:t};return null},A=(t,e)=>{var n=Math.abs(t.x-e.x),o=Math.abs(t.y-e.y);return!(1!==n&&1!==o||t.x!==e.x&&t.y!==e.y)},M=(t,e,n)=>{var o=n[t.y][t.x];n[t.y][t.x]=n[e.y][e.x],n[e.y][e.x]=o},F=({blankCoords:n,matrix:o,blockedCoords:r})=>{const a=[];for(let e=0;e<o.length;e++)for(let t=0;t<o[e].length;t++)!A({x:t,y:e},n)||r&&r.x===t&&r.y===e||a.push({x:t,y:e});return a};const G=(t,e)=>{t.y>=f.length||t.y<0||t.x>=f.length||t.x<0||(L(),M(t,e,f),J(f))};t.addEventListener("click",({target:t})=>{var e;I||(t=t.closest(".app__puzzle--btn"))&&(t=Number(t.dataset.matrixId),t=O(t,f),e=O(x,f),t=t,e=e,A(t,e)&&(L(),M(t,e,f),J(f)))}),e.addEventListener("click",()=>{I||(g.count=0,n.textContent=g.count,I=!0,v=0,clearInterval(C),0===v&&(C=setInterval(()=>{var t,e,n;t=f,e=O(x,t),n=(n=F({blankCoords:e,matrix:t,blockedCoords:_}))[Math.floor(Math.random()*n.length)],M(e,n,t),_=e,J(f),100<=(v+=1)&&(B(o,"hide"),B(d,"hide"),N(u,"hide"),S=0,b=0,E=0,y.textContent=w(E),i.textContent=w(b),m.textContent=w(S),clearInterval(C),clearInterval(k),k=setInterval(D,10),I=!1)},20)))}),document.body.addEventListener("keydown",t=>{if(!I&&t.key.includes("Arrow")){var e=O(x,f),n={x:e.x,y:e.y},t=t.key.split("Arrow")[1].toLowerCase(),o=n,n=e;switch(t){case"up":o.y+=1;break;case"down":--o.y;break;case"left":o.x+=1;break;case"right":--o.x}G(o,n)}});if(setTimeout(T,3e3),c.length<h)throw new Error(`Должно быть ровно ${h} items in HTML`);c[h-1].style.display="none";var K=c.map(t=>Number(t.dataset.matrixId));f=(t=>{const e=[[],[],[],[]];let n=0,o=0;for(var r of t)o>=q&&(n++,o=0),e[n][o]=r,o++;return e})(K),J(f)};appPuzzle();