"use strict";const appPuzzle=()=>{const e=document.getElementById("app__puzzle"),n=document.getElementById("app__puzzle--lock"),o=document.getElementById("app__shuffle"),t=document.getElementById("app__counter"),T=document.getElementById("app__result--count"),M=document.getElementById("app__result--time"),$=document.getElementById("app__record--count"),P=document.getElementById("app__record--time"),a=Array.from(e.querySelectorAll(".app__puzzle--btn")),r=document.querySelector(".app__rules"),l=document.querySelector(".app__box"),c=document.querySelector(".app__puzzle--public"),i=document.querySelector(".app__record"),u=document.querySelector(".app__record--time"),d=document.querySelector(".app__actual"),D=new Audio("./audio/valid.mp3"),H=new Audio("./audio/no-valid.mp3"),s=new Audio("./audio/won.mp3"),m=document.querySelector(".preloader"),p=document.getElementById("minute"),y=document.getElementById("second"),g=document.getElementById("millisecond"),x=new Array(16).fill(0).map((t,e)=>e+1),_={count:0,maxCount:99999,time:"00:00:00",ms:0},h=16,j=4,F=100;let v=!1,f=[],I=null,b=null,C=null,S=0,w=0,E=0,z=null;t.textContent=_.count;const G=()=>{S=0,w=0,E=0,g.textContent=A(E),y.textContent=A(w),p.textContent=A(S)},k=()=>{var t=JSON.parse(localStorage.getItem("data"));$.textContent=t.count,P.textContent=t.time},K=()=>{window.navigator&&window.navigator.vibrate&&(navigator.vibrate(100),H.play())},A=t=>t<10?"0"+t:t,B=(t,e)=>t.classList.add(e),L=(t,e)=>t.classList.remove(e),q=t=>{c.textContent=t,B(c,"open"),setTimeout(()=>L(c,"open"),5e3)},Q=()=>{_.count<_.maxCount&&(_.count++,t.textContent=_.count)},R=()=>{m.classList.contains("hide")||B(m,"hide")},U=()=>{59<w&&(S++,p.textContent=A(S),w=0,y.textContent=A(w)),59===S&&59===w&&99===E&&G()},V=()=>{E++,g.textContent=A(E),99<E&&(w++,y.textContent=A(w),E=0,g.textContent=A(E)),U()},W=()=>{var t;localStorage.length<1&&(localStorage.setItem("data",JSON.stringify(_)),k()),1<=localStorage.length&&(k(),localStorage.getItem("data")&&(t=JSON.parse(localStorage.getItem("data")),0<_.count&&0===t.count&&(localStorage.setItem("data",JSON.stringify(_)),k(),q("Рекорд установлен!"),B(i,"animate-opacity"),s.play()),0!==_.count&&_.count<t.count&&(localStorage.setItem("data",JSON.stringify(_)),k(),q("Новый рекорд!"),B(i,"animate-opacity"),s.play()),_.count>=t.count&&0<t.count&&(q("Рекорд не побит!"),B(d,"animate-opacity"),s.play()),_.count===t.count&&_.ms<t.ms&&(localStorage.setItem("data",JSON.stringify(_)),k(),q("Время улучшено!"),B(u,"animate-opacity"),s.play())))},X=()=>{var t;(t=>{var e=t.flat();for(let t=0;t<x.length;t++)if(e[t]!==x[t])return!1;return!0})(f)?(_.time=`${A(S)}:${A(w)}:`+A(E),_.ms=10*(t=_.time.split(":"))[2]+1e3*t[1]+6e4*t[0],W(),o.getAttribute("disabled")&&o.removeAttribute("disabled"),clearInterval(z),s.currentTime=0,T.textContent=_.count,M.textContent=_.time,L(n,"hide"),B(l,"hide"),L(r,"hide"),setTimeout(()=>L(e,"won"),70)):setTimeout(()=>B(e,"won"),70)},Y=(t,e,n)=>{t.style.transform=`translate3D(${100*e}%, ${100*n}%, 0)`},N=n=>{for(let e=0;e<n.length;e++)for(let t=0;t<n[e].length;t++){var o=n[e][t],o=a[o-1];Y(o,t,e)}X()},J=(n,o)=>{for(let e=0;e<o.length;e++)for(let t=0;t<o[e].length;t++)if(o[e][t]===n)return{y:e,x:t};return null},Z=(t,e)=>{var n=Math.abs(t.x-e.x),o=Math.abs(t.y-e.y);return!(1!==n&&1!==o||t.x!==e.x&&t.y!==e.y)},O=(t,e,n)=>{var o=n[t.y][t.x];n[t.y][t.x]=n[e.y][e.x],n[e.y][e.x]=o},tt=t=>{var e=J(16,t),n=(({blankCoords:n,matrix:o,blockedCoords:a})=>{const r=[];for(let e=0;e<o.length;e++)for(let t=0;t<o[e].length;t++)!Z({x:t,y:e},n)||a&&a.x===t&&a.y===e||r.push({x:t,y:e});return r})({blankCoords:e,matrix:t,blockedCoords:I}),n=n[Math.floor(Math.random()*n.length)];O(e,n,t),I=e};const et=(t,e)=>{t.y>=f.length||t.y<0||t.x>=f.length||t.x<0||(Q(),O(t,e,f),N(f))};e.addEventListener("click",({target:t})=>{var e;v||(t=t.closest(".app__puzzle--btn"))&&(t=Number(t.dataset.matrixId),t=J(t,f),e=J(16,f),t=t,e=e,Z(t,e)?(Q(),D.play(),O(t,e,f),N(f)):K())}),o.addEventListener("click",()=>{v||(v=!0,b=0,_.count=0,t.textContent=_.count,c.classList.contains("open")&&L(c,"open"),[i,u,d].forEach(t=>{t.classList.contains("animate-opacity")&&L(t,"animate-opacity")}),clearInterval(C),0===b&&(C=setInterval(()=>{tt(f),N(f),o.setAttribute("disabled",!0),(b+=1)>=F&&(B(n,"hide"),B(r,"hide"),L(l,"hide"),G(),clearInterval(C),clearInterval(z),z=setInterval(V,10),v=!1)},20)))}),document.body.addEventListener("keydown",t=>{if(!v&&t.key.includes("Arrow")){var e=J(16,f),n={x:e.x,y:e.y},t=t.key.split("Arrow")[1].toLowerCase(),o=n,n=e;switch(t){case"up":o.y+=1;break;case"down":--o.y;break;case"left":o.x+=1;break;case"right":--o.x}et(o,n)}});if(setTimeout(R,2e3),a.length<h)throw new Error(`Должно быть ровно ${h} items in HTML`);a[h-1].style.display="none";var nt=a.map(t=>Number(t.dataset.matrixId));f=(t=>{const e=[[],[],[],[]];let n=0,o=0;for(var a of t)o>=j&&(n++,o=0),e[n][o]=a,o++;return e})(nt),N(f)};appPuzzle();