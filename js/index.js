"use strict";function _createForOfIteratorHelper(t,e){var n,o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length)return o&&(t=o),n=0,{s:e=function(){},n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,u=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return a=t.done,t},e:function(t){u=!0,r=t},f:function(){try{a||null==o.return||o.return()}finally{if(u)throw r}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var appPuzzle=function(){function e(){var t=JSON.parse(localStorage.getItem("data"));F.textContent=t.count,P.textContent=t.time}function n(t){return t<10?"0"+t:t}function o(t){f.textContent=t,L(f,"open"),setTimeout(function(){return T(f,"open")},5e3)}function J(){59<E&&(C++,Q.textContent=n(C),E=0,h.textContent=n(E)),59===C&&59===E&&99===k&&(clearInterval(z),t())}function M(){var t;_.ms===_.limit&&(o("Лимит по времени исчерпан!"),L(y,"animate-opacity"),Y(),_.count=0,_.time="00:00:00",B(g)),localStorage.length<1&&(localStorage.setItem("data",JSON.stringify(_)),e()),1<=localStorage.length&&(e(),localStorage.getItem("data")&&(t=JSON.parse(localStorage.getItem("data")),0<_.count&&0===t.count&&(localStorage.setItem("data",JSON.stringify(_)),e(),o("Рекорд установлен!"),L(p,"animate-opacity"),B(v)),0!==_.count&&_.count<t.count&&(localStorage.setItem("data",JSON.stringify(_)),e(),o("Новый рекорд!"),L(p,"animate-opacity"),B(v)),_.count>=t.count&&0<t.count&&(o("Рекорд не побит!"),L(y,"animate-opacity"),B(g)),_.count===t.count&&_.ms<t.ms&&(localStorage.setItem("data",JSON.stringify(_)),e(),o("Время улучшено!"),L(D,"animate-opacity"),B(v))))}function r(t,e){for(var n=0;n<e.length;n++)for(var o=0;o<e[n].length;o++)if(e[n][o]===t)return{y:n,x:o};return null}function t(){if(l.length<b)throw new Error("Должно быть ровно ".concat(b," items in HTML"));l[b-1].style.display="none";var t=l.map(function(t){return Number(t.dataset.matrixId)});S=function(t){var e,n=[[],[],[],[]],o=0,r=0,a=_createForOfIteratorHelper(t);try{for(a.s();!(e=a.n()).done;){var u=e.value;V<=r&&(o++,r=0),n[o][r]=u,r++}}catch(t){a.e(t)}finally{a.f()}return n}(t),q(S)}var a=document.getElementById("app__puzzle"),u=document.getElementById("app__puzzle--lock"),i=document.getElementById("app__shuffle"),c=document.getElementById("app__counter"),j=document.getElementById("app__result--count"),H=document.getElementById("app__result--time"),F=document.getElementById("app__record--count"),P=document.getElementById("app__record--time"),l=Array.from(a.querySelectorAll(".app__puzzle--btn")),d=document.querySelector(".app__puzzle--shuffle"),m=document.querySelector(".app__rules"),s=document.querySelector(".app__box"),f=document.querySelector(".app__puzzle--public"),p=document.querySelector(".app__record"),D=document.querySelector(".app__record--time"),y=document.querySelector(".app__actual"),U=new Audio("./audio/valid.mp3"),$=new Audio("./audio/no-valid.mp3"),g=new Audio("./audio/won.mp3"),v=new Audio("./audio/record.mp3"),G=new Audio("./audio/start.mp3"),K=document.querySelector(".preloader"),Q=document.getElementById("minute"),h=document.getElementById("second"),x=document.getElementById("millisecond"),R=new Array(16).fill(0).map(function(t,e){return e+1}),_={count:0,maxCount:9999,time:"00:00:00",ms:0,limit:3599990},b=16,V=4,W=100,I=!1,S=[],X=null,w=null,A=null,C=0,E=0,k=0,z=null,Y=(c.textContent=_.count,function(){k=E=C=0,x.textContent=n(k),h.textContent=n(E),Q.textContent=n(C)}),Z=function(){window.navigator&&window.navigator.vibrate&&navigator.vibrate(100),B($)},L=function(t,e){return t.classList.add(e)},T=function(t,e){return t.classList.remove(e)},tt=function(){_.count<_.maxCount&&(_.count++,c.textContent=_.count)},B=function(t){return t.play()},O=function(t){return t.currentTime=0},et=function(){k++,x.textContent=n(k),99<k&&(E++,h.textContent=n(E),k=0,x.textContent=n(k)),J()},nt=function(){var t;!function(t){for(var e=t.flat(),n=0;n<R.length;n++)if(e[n]!==R[n])return!1;return!0}(S)?setTimeout(function(){return L(a,"won")},70):(_.time="".concat(n(C),":").concat(n(E),":").concat(n(k)),_.ms=10*(t=_.time.split(":"))[2]+1e3*t[1]+6e4*t[0],M(),i.getAttribute("disabled")&&i.removeAttribute("disabled"),clearInterval(z),O(g),j.textContent=_.count,H.textContent=_.time,T(u,"hide"),L(s,"hide"),T(m,"hide"),setTimeout(function(){return T(a,"won")},70))},ot=function(t,e,n){t.style.transform="translate3D(".concat(100*e,"%, ").concat(100*n,"%, 0)")},q=function(t){for(var e=0;e<t.length;e++)for(var n=0;n<t[e].length;n++){var o=t[e][n],o=l[o-1];ot(o,n,e)}nt()},rt=function(t,e){var n=Math.abs(t.x-e.x),o=Math.abs(t.y-e.y);return!(1!==n&&1!==o||t.x!==e.x&&t.y!==e.y)},N=function(t,e,n){var o=n[t.y][t.x];n[t.y][t.x]=n[e.y][e.x],n[e.y][e.x]=o},at=function(t){var e=r(16,t),n=function(t){for(var e=t.blankCoords,n=t.matrix,o=t.blockedCoords,r=[],a=0;a<n.length;a++)for(var u=0;u<n[a].length;u++)!rt({x:u,y:a},e)||o&&o.x===u&&o.y===a||r.push({x:u,y:a});return r}({blankCoords:e,matrix:t,blockedCoords:X}),n=n[Math.floor(Math.random()*n.length)];N(e,n,t),X=e},ut=function(t,e){t.y>=S.length||t.y<0||t.x>=S.length||t.x<0||(tt(),N(t,e,S),q(S))};a.addEventListener("click",function(t){var e,t=t.target;I||(t=t.closest(".app__puzzle--btn"))&&(t=Number(t.dataset.matrixId),t=r(t,S),e=r(16,S),rt(t=t,e=e)?(tt(),O(U),B(U),N(t,e,S),q(S)):(O($),Z()))}),i.addEventListener("click",function(){I||(I=!0,w=0,_.count=0,c.textContent=_.count,f.classList.contains("open")&&T(f,"open"),[p,D,y].forEach(function(t){t.classList.contains("animate-opacity")&&T(t,"animate-opacity")}),clearInterval(A),0===w&&(L(d,"animate-btn"),setTimeout(function(){T(d,"animate-btn")},1150),O(G),B(G),A=setInterval(function(){at(S),q(S),i.setAttribute("disabled",!0),W<=(w+=1)&&(L(u,"hide"),L(m,"hide"),T(s,"hide"),Y(),clearInterval(A),clearInterval(z),z=setInterval(et,10),I=!1)},20)))}),document.body.addEventListener("keydown",function(t){if(!I&&t.key.includes("Arrow")){var e=r(16,S),n={x:e.x,y:e.y},t=t.key.split("Arrow")[1].toLowerCase(),o=n,n=e;switch(t){case"up":o.y+=1;break;case"down":--o.y;break;case"left":o.x+=1;break;case"right":--o.x}ut(o,n)}});setTimeout(function(){K.classList.contains("hide")||L(K,"hide")},2e3),t()};appPuzzle();