"use strict";const appPuzzle=()=>{const e=document.getElementById("app__puzzle"),r=document.getElementById("app__puzzle--lock"),t=document.getElementById("app__shuffle"),n=document.getElementById("app__counter"),l=document.getElementById("app__result--count"),o=document.getElementById("app__result--time"),a=(document.getElementById("app__record--count"),document.getElementById("app__record--time"),Array.from(e.querySelectorAll(".app__puzzle--btn"))),d=document.querySelector(".app__rules"),s=document.querySelector(".app__box"),c=document.querySelector(".preloader"),u=document.getElementById("minute"),m=document.getElementById("second"),i=document.getElementById("millisecond"),y=new Array(16).fill(0).map((e,t)=>t+1),p=16,x=16,h=4;let g=!1,_=[],f=null,v=null,I=null,C=0,b=0,E=0,k=0,z=null,w;n.textContent=C;const B=e=>e<10?"0"+e:e,L=(e,t)=>e.classList.add(t),A=(e,t)=>e.classList.remove(t),M=()=>{C++,n.textContent=C},N=()=>{c.classList.contains("hide")||L(c,"hide")},P=()=>{99<k&&(E++,m.textContent=B(E),k=0,i.textContent=B(k)),59<E&&(b++,u.textContent=B(b),E=0,m.textContent=B(E))},D=()=>{k++,i.textContent=B(k),P()},H=()=>{(e=>{var t=e.flat();for(let e=0;e<y.length;e++)if(t[e]!==y[e])return!1;return!0})(_)?(clearInterval(z),w=`${B(b)}:${B(E)}:`+B(k),l.textContent=C,o.textContent=w,A(r,"hide"),L(s,"hide"),A(d,"hide"),setTimeout(()=>A(e,"won"),70)):setTimeout(()=>L(e,"won"),70)},j=(e,t,n)=>{e.style.transform=`translate3D(${100*t}%, ${100*n}%, 0)`},$=n=>{for(let t=0;t<n.length;t++)for(let e=0;e<n[t].length;e++){var r=n[t][e],r=a[r-1];j(r,e,t)}H()},q=(n,r)=>{for(let t=0;t<r.length;t++)for(let e=0;e<r[t].length;e++)if(r[t][e]===n)return{y:t,x:e};return null},S=(e,t)=>{var n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y);return!(1!==n&&1!==r||e.x!==t.x&&e.y!==t.y)},T=(e,t,n)=>{var r=n[e.y][e.x];n[e.y][e.x]=n[t.y][t.x],n[t.y][t.x]=r},F=({blankCoords:n,matrix:r,blockedCoords:l})=>{const o=[];for(let t=0;t<r.length;t++)for(let e=0;e<r[t].length;e++)!S({x:e,y:t},n)||l&&l.x===e&&l.y===t||o.push({x:e,y:t});return o};const G=(e,t)=>{e.y>=_.length||e.y<0||e.x>=_.length||e.x<0||(M(),T(e,t,_),$(_))};e.addEventListener("click",({target:e})=>{var t;g||(e=e.closest(".app__puzzle--btn"))&&(e=Number(e.dataset.matrixId),e=q(e,_),t=q(p,_),e=e,t=t,S(e,t)&&(M(),T(e,t,_),$(_)))}),t.addEventListener("click",()=>{g||(C=0,n.textContent=C,g=!0,v=0,clearInterval(I),0===v&&(I=setInterval(()=>{var e,t,n;e=_,t=q(p,e),n=(n=F({blankCoords:t,matrix:e,blockedCoords:f}))[Math.floor(Math.random()*n.length)],T(t,n,e),f=t,$(_),100<=(v+=1)&&(L(r,"hide"),L(d,"hide"),A(s,"hide"),b=0,E=0,k=0,i.textContent=B(k),m.textContent=B(E),u.textContent=B(b),clearInterval(I),clearInterval(z),z=setInterval(D,10),g=!1)},20)))}),document.body.addEventListener("keydown",e=>{if(!g&&e.key.includes("Arrow")){var t=q(p,_),n={x:t.x,y:t.y},e=e.key.split("Arrow")[1].toLowerCase(),r=n,n=t;switch(e){case"up":r.y+=1;break;case"down":--r.y;break;case"left":r.x+=1;break;case"right":--r.x}G(r,n)}});if(setTimeout(N,3e3),a.length<x)throw new Error(`Должно быть ровно ${x} items in HTML`);a[x-1].style.display="none";var J=a.map(e=>Number(e.dataset.matrixId));_=(e=>{const t=[[],[],[],[]];let n=0,r=0;for(var l of e)r>=h&&(n++,r=0),t[n][r]=l,r++;return t})(J),$(_)};appPuzzle();